

<prompt>> <cursor id="cursor">_</cursor></prompt>

<style>
  body {
    font-size: 24pt;
    margin: 0;
    background: aquamarine;
    background: deeppink;
    color: #befbbc;
    direction: rtl;
    bottom: 0;
    position: absolute;
    width: 100%;
  }
  prompt {
    display: block;
    color: #ff7bf7;
    /* position: fixed; */
    bottom: 0;
    padding: 0 .7em;
    /* margin: 0 -.7em; */
    /* width: 100%; */
    border-top: 1px solid #ff7bf7;
    line-height: 1.6em;
    background: #ff5eed;
    color: #befbbc;
    height: 1.6em;
  }
  cursor {
    height: 100%;
    display: inline-block;
    animation: blink;
    animation: blink 1s step-start .5s infinite;
  }
  @keyframes blink { 50% { opacity: 0; }}
</style>

<script src="bubblescript.js">
  (mufn get-id [a]
   (document.getElementById a))
</script>

<script type='text/bubblescript'>
    ;ns repl

   (muf get-id (fn [a]
      (send document 'getElementById a)))

    muf cursor (get-id "cursor")
    muf prompt  (get cursor 'parentNode)

    print "candi"
    ;repl/cursor

    ;muf br (fn [ðŸ’…ðŸ¤·ðŸ½â€â™€ï¸ðŸ‘‘]
    ;  (document.createElement "br"))

    muf br (fn [ðŸ’…ðŸ¤·ðŸ½â€â™€ï¸ðŸ‘‘],
      (send  document 'createElement "br"))

    ;mufn br [m e o w],
    ;  (send document 'createElement "br")

    muf print (fn [msg]
      (send (get document 'body)
        'insertBefore
        msg
        prompt))

    muf println (fn [msg]
      (print msg (br)))

    muf println (fn [msg]
      (print (send document 'createTextNode msg))
      (print (br)))

    muf typeChar (fn [ch]
      (send prompt 'insertBefore
        (send document 'createTextNode ch)
         cursor))

    muf clear (fn []
      (export  prompt 'innerHTML "> ")
      (send prompt 'append cursor))

    muf backspace (fn [q]
      (send prompt 'removeChild
         (get cursor 'previousSibling)))

      muf muff muf

      muf push (fn [a b]
        (send a 'push b))

       muf mufn,
         (macro [name args & body]
           (list 'muf name
              (push (push body args) 'fn)))

     mufn read [],
       (send (get prompt 'innerText) 'slice 2
           (- (get prompt 'innerText 'length) 1))

       muff ðŸ˜‹ (fn []
         (let [v (read)]
            (println v)
            (print (send document 'createTextNode ";=> "))
            ;(println (evl (parse v)))
            (println (parse v))
            (clear)))

        muf do list

        muf arrow-left (fn []
          (send prompt 'insertBefore cursor
             (get cursor 'previousSibling)))

         muf arrow-right (fn []
           (send prompt 'insertBefore
              (get cursor 'nextSibling)
              cursor))

          send window 'addEventListener 'keydown,
            (jsfn [e]
              (if (= e.key "Backspace")
                (do (send e 'preventDefault)
                     (backspace))
              (if (= e.key "ArrowRight")
                (arrow-right)
              (if (= e.key "ArrowLeft")
                (arrow-left)))))

        send window 'addEventListener 'keypress,
          (jsfn [e]
            (if (= (get e 'key) "Enter")
              (ðŸ˜‹)
              (typeChar (get e 'key))))

           window.xoxo

</script>
